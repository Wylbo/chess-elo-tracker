<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess ELO Tracker</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3"></script>
    <!-- Chessboard libraries for game replay -->
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.12.0/chess.min.js"></script>
    <!-- Stockfish.js for game analysis -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stockfish.js/10.0.2/stockfish.js"></script>
</head>

<body>
    <div class="shell">
        <div class="header">
            <div class="title">Chess ELO Tracker</div>
            <!-- <div class="subtitle">Track Chess.com ratings for you and your friends. Add usernames, choose a time
                control, and toggle curves to see how everyone is progressing.</div> -->
        </div>

        <div class="panels">
            <div class="panel controls">
                <form id="add-form">
                    <div class="field">
                        <label for="username">Chess.com username</label>
                        <input id="username" name="username" type="text" autocomplete="off" placeholder="e.g. hikaru"
                            required>
                    </div>
                    <div class="field field-time-control">
                        <label for="time-class">Time control</label>
                        <select id="time-class" name="time-class">
                            <option value="blitz">Blitz</option>
                            <option value="bullet">Bullet</option>
                            <option value="rapid">Rapid</option>
                            <option value="daily">Daily</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="primary-btn">Add player</button>
                        <button type="button" class="secondary-btn" id="refresh-btn">Refresh data</button>
                    </div>
                </form>
                <div class="hint">Uses public Chess.com data. Fetches the last few months of games for the selected time
                    control and adds the most recent rating from Chess.com stats.</div>
                <div id="status" class="status" data-tone="info">Waiting for players to track.</div>
                <div class="collapsible">
                    <button class="collapsible-trigger" type="button" id="players-toggle" aria-expanded="true">
                        <span>Tracked players</span>
                        <span class="pill" id="player-count">0</span>
                        <span class="chevron" aria-hidden="true">v</span>
                    </button>
                    <div class="collapsible-body" id="players-body">
                        <div class="collapsible-inner">
                            <div class="list" id="player-list"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel chart-panel">
                <div class="range-panel">
                    <div class="range-header">
                        <div class="range-buttons">
                            <button type="button" data-window="7">1w</button>
                            <button type="button" data-window="30">1m</button>
                            <button type="button" data-window="90">3m</button>
                            <button type="button" data-window="180" class="active">6m</button>
                            <button type="button" data-window="365">1y</button>
                            <button type="button" data-window="max">max</button>
                        </div>
                        <span class="range-values" id="window-value">180 days</span>
                    </div>
                </div>
                <div class="chart-wrap">
                    <canvas id="elo-chart"></canvas>
                </div>
                <div class="range-selector-panel">
                    <div class="range-selector-wrap">
                        <canvas id="range-chart"></canvas>
                        <div id="range-overlay" class="range-overlay"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Weekly Best/Worst Games Section -->
        <div class="weekly-games-section panel">
            <div class="collapsible">
                <button class="collapsible-trigger" type="button" id="weekly-toggle" aria-expanded="true">
                    <span>Weekly Best/Worst Games</span>
                    <span class="chevron" aria-hidden="true">v</span>
                </button>
                <div class="collapsible-body" id="weekly-body">
                    <div class="collapsible-inner">
                        <div id="weekly-status" class="status" data-tone="info">
                            Add players to see their best and worst games from the last 7 days.
                        </div>
                        <div class="analysis-progress hidden" id="analysis-progress">
                            <div class="analysis-progress-bar" id="analysis-progress-bar"></div>
                        </div>
                        <table class="weekly-table" id="weekly-table">
                            <thead>
                                <tr>
                                    <th>Player</th>
                                    <th>Best Game</th>
                                    <th>Worst Game</th>
                                </tr>
                            </thead>
                            <tbody id="weekly-table-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Replay Modal -->
    <div class="modal-overlay hidden" id="game-modal-overlay">
        <div class="modal game-modal" id="game-modal">
            <div class="modal-header">
                <h3 id="modal-title">Game Replay</h3>
                <button class="modal-close" id="modal-close" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="game-info" id="game-info">
                    <span class="game-players" id="modal-players"></span>
                    <span class="game-result" id="modal-result"></span>
                    <span class="game-accuracy" id="modal-accuracy"></span>
                </div>
                <div class="board-container">
                    <div id="chess-board"></div>
                </div>
                <div class="playback-controls">
                    <button class="control-btn" id="btn-start" title="Start">&#8676;</button>
                    <button class="control-btn" id="btn-prev" title="Previous">&larr;</button>
                    <button class="control-btn" id="btn-play" title="Play/Pause">&#9658;</button>
                    <button class="control-btn" id="btn-next" title="Next">&rarr;</button>
                    <button class="control-btn" id="btn-end" title="End">&#8677;</button>
                </div>
                <div class="move-display">
                    <span id="move-counter">Move 0 / 0</span>
                </div>
                <div class="move-list" id="move-list"></div>
            </div>
            <div class="modal-footer">
                <a href="#" target="_blank" rel="noopener" id="view-on-chesscom" class="secondary-btn">
                    View on Chess.com
                </a>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>